<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> 
<html>
	<head>
	<!-- 'https://developers.google.com/api-client-library/javascript/samples/samples' -->
	</head>
	<body>
		<script async defer src="https://apis.google.com/js/api.js"
			onload="this.onload=function(){};handleClientLoad()"
			onreadystatechange="if (this.readyState === 'complete') this.onload()">
		</script>
		<button id="signin-button" onclick="handleSignInClick()">Sign In</button>
		<button id="signout-button" onclick="handleSignOutClick()">Sign Out</button>
		<div id="console"></div>
		<div id="description"></div>
		<script type="text/javascript">
			function handleClientLoad() {
				// Loads the client library and the auth2 library together for efficiency.
				// Loading the auth2 library is optional here since `gapi.client.init` function will load
				// it if not already loaded. Loading it upfront can save one network request.
				gapi.load('client:auth2', initClient);
			}

			function initClient() {
				// Initialize the client with API key and People API, and initialize OAuth with an
				// OAuth 2.0 client ID and scopes (space delimited string) to request access.
				gapi.client.init({
					apiKey: 'AIzaSyCfbrzcjjrBj2QCoERl15jaMuvruOA7UDE',
					discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest"],
					clientId: '681391917174-t1ruo3j36g1nbjthpalgn484rspfqbl5.apps.googleusercontent.com',
					scope: 'https://www.googleapis.com/auth/youtube'
				}).then(function () {
					// Listen for sign-in state changes.
					gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
					// Handle the initial sign-in state.
					updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
				});
			}
			
			function updateSigninStatus(isSignedIn) {
				// When signin status changes, this function is called.
				// If the signin status is changed to signedIn, we make an API call.
				if (isSignedIn) {
					makeApiCall();
				}
			}

			function handleSignInClick(event) {
				// Ideally the button should only show up after gapi.client.init finishes, so that this
				// handler won't be called before OAuth is initialized.
				gapi.auth2.getAuthInstance().signIn();
			}

			function handleSignOutClick(event) {
				gapi.auth2.getAuthInstance().signOut();
			}

			function makeApiCall() {
				
				var batch = gapi.client.newBatch();
				
				var searchRequest = function(name) {
				
					return gapi.client.request({
						'path':'youtube/v3/search',
						'params':{
									"q": name,
									"part": "snippet"
								}
							
					});
					/*
					.then(function(response) {
						var str = JSON.stringify(response.result);
						document.getElementById('console').innerHTML ='<pre>' + response.result.items[0].snippet.title + '</pre>';
					});
					*/
				};
				
				var statRequest = function(vid) {
					
					return gapi.client.request({
						'path':'youtube/v3/videos',
						'params':{
									"part":"statistics",
									"id": vid
								}
							
					});
					/*.then(function(response) {
						var str = JSON.stringify(response.result);
						document.getElementById('description').innerHTML ='<pre>' + response.result.items[0].statistics.viewCount + '</pre>';
					});
					*/
				}
				
				var searchSong = [];
				
				searchSong.push(searchRequest("Jennifer Lopez - Ain't Your Mama"));
				searchSong.push(statRequest("Pgmx7z49OEk"));
				
				batch.add(searchSong[0], {'id': 'searchTitle'});
				batch.add(searchSong[1], {'id': 'searchViewCount'});
				
				batch.then(function(response) {
						var str = JSON.stringify(response.result);
						//document.getElementById('description').innerHTML = str;
						
						document.getElementById('description').innerHTML =
							"[" + response.result.searchTitle.result.items[0].id.videoId + "] " + response.result.searchTitle.result.items[0].snippet.title + ": [" + response.result.searchViewCount.result.items[0].id + "] " + response.result.searchViewCount.result.items[0].statistics.viewCount;
						
				});
				
				/*
				var request = gapi.client.youtube.search.list({
					q: 'gold fund',
					part: 'snippet'
				});
				
				request.execute(function(response) {
					var str = JSON.stringify(response.result);
					document.getElementById('console').innerHTML ='<pre>' + response.result.items[0].snippet.title + '</pre>';
				});
				*/
				
			}
		</script>
	</body>
</html>